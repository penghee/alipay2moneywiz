# 使用指南

## 新功能说明

本项目现在支持统一的导入和预览功能，可以更方便地管理和分析账单数据。

## 1. 导入账单

使用 `import` 命令可以导入支付宝或微信账单，并自动分类保存到 `data` 目录。

### 基本用法

```bash
npm run import -- --file <文件路径> --platform <平台>
```

### 参数说明

- `--file`: 账单文件路径（支持 `~` 表示用户主目录）
- `--platform`: 平台类型，支持 `alipay`（支付宝）或 `wechat`（微信）

### 示例

导入支付宝账单：
```bash
npm run import -- --file ~/Downloads/alipay_2024_01.csv --platform alipay
```

导入微信账单：
```bash
npm run import -- --file ~/Downloads/wechat_2024_01.csv --platform wechat
```

### 输出示例

```
正在处理 alipay 账单...
✓ 成功解析 150 条记录
✓ 自动分类完成
✓ 保存到 data/2024/01.csv
```

### 数据存储结构

导入的数据会按照年月自动组织：
```
data/
├── 2024/
│   ├── 01.csv
│   ├── 02.csv
│   └── ...
└── 2025/
    ├── 01.csv
    └── ...
```

## 2. 预览月度数据

查看指定月份的账单统计信息。

### 基本用法

```bash
npm run preview -- --year <年份> --month <月份>
```

### 示例

```bash
npm run preview -- --year 2024 --month 1
```

### 输出示例

```
📊 2024年1月 账单统计
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
收入总计: ¥10,000.00
支出总计: ¥6,500.00
结余: ¥3,500.00

支出分类明细:
┌──────────┬──────────┬────────┬────────┐
│ 分类     │ 金额     │ 占比   │ 笔数   │
├──────────┼──────────┼────────┼────────┤
│ 餐饮     │ 1,500.00 │  23.1% │     45 │
│ 交通     │   800.00 │  12.3% │     30 │
│ 购物     │ 2,000.00 │  30.8% │     20 │
│ 娱乐     │   500.00 │   7.7% │      8 │
│ 其他     │ 1,700.00 │  26.1% │     15 │
└──────────┴──────────┴────────┴────────┘
```

## 3. 预览年度数据

查看全年的账单统计和月度趋势。

### 基本用法

```bash
npm run preview -- --year <年份>
```

### 示例

```bash
npm run preview -- --year 2024
```

### 输出示例

```
📊 2024年 全年统计
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
收入总计: ¥120,000.00
支出总计: ¥78,000.00
结余: ¥42,000.00

月度趋势:
┌────────┬──────────┬──────────┬──────────┐
│ 月份   │ 收入     │ 支出     │ 结余     │
├────────┼──────────┼──────────┼──────────┤
│ 01月   │ 10,000.00│  6,500.00│  3,500.00│
│ 02月   │ 10,000.00│  6,800.00│  3,200.00│
│ 03月   │ 10,000.00│  6,200.00│  3,800.00│
│ ...    │      ... │      ... │      ... │
└────────┴──────────┴──────────┴──────────┘
```

## 分类说明

系统会自动将交易分类到以下类别：

- **餐饮**: 餐饮美食、外卖、咖啡等
- **百货**: 超市、便利店、购物等  
- **交通**: 打车、地铁、公交、加油等
- **通讯**: 手机充值、话费等
- **娱乐**: 电影、游戏、旅游等
- **医疗**: 医院、药店、体检等
- **教育**: 学费、培训、课程等
- **住房**: 房租、物业、水电费等
- **服饰**: 服装、化妆品、美容等
- **数码**: 手机、电脑、家电等
- **转账**: 红包、还款、理财等
- **其他**: 未匹配的杂项

可以通过编辑 `category_map.json` 来自定义分类规则。

## 完整工作流程

1. **下载账单**: 从支付宝/微信下载账单 CSV 文件

2. **导入数据**: 
   ```bash
   npm run import -- --file ~/Downloads/alipay_2024_01.csv --platform alipay
   ```

3. **查看月度统计**:
   ```bash
   npm run preview -- --year 2024 --month 1
   ```

4. **查看年度统计**:
   ```bash
   npm run preview -- --year 2024
   ```

## 注意事项

1. 导入的数据会保存在 `data` 目录，该目录已添加到 `.gitignore`，不会被提交到版本控制
2. 如果同一个月份的数据被重复导入，新数据会覆盖旧数据
3. 确保 `account_map.json` 和 `category_map.json` 已正确配置
4. 账单文件需要是支付宝或微信官方导出的标准格式

## 原有功能

原有的交互式导入功能仍然可用：

```bash
npm run alipay   # 支付宝账单转换
npm run wechat   # 微信账单转换
npm run jd       # 京东账单转换
npm run icost    # iCost 账单转换
```
